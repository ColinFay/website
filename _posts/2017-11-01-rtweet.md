---
title: "Collecting tweets with R and {rtweet}"
author: colin_fay
post_date: 2017-11-01
layout: single
permalink: /collect-rtweet/
categories : r-blog-en
excerpt_separator: <!--more-->
---

Some arguments in favor of [{rtweet}](https://CRAN.R-project.org/package=rtweet ), an amazing package by Michael W. Kearney. 

<!--more-->

> Note: this post has been updated after recent changes in the {rtweet} package

For what I remember, I have been scraping web data for as long as I've been using R. This, of course, includes Google Analytics, Facebook, raw web pages, and so on and so forth — but most of all, I've always loved playing with Twitter data. I've been on Twitter for [8 years now](https://twitter.com/_ColinFay/status/922304944971173888), and I know what an insightful place it can be, and also, it's full of data, so you know, why not going down that rabbit hole! 

## A long time ago, in a far away land

My first encounter with tweet collecting in R has been through the {twitteR} package, which, despite its (sometimes) weird interface and strange functions, has been really useful in many past projects.

So, before {rtweet}, the common practice was to mine Twitter with {twitteR}, which was designed as an object oriented package (so not tidy): calls on the API create environments, in which you can use methods for further investigation. Also, results were not in a data.frame format (even if there is a funtion to turn twitter lists to df). 

Searching for tweets was quite straightforward: setting up oauth, search twitter, convert result to dataframe, dealing with dates... but a drawback was when doing text mining: you had to look for hashtags by subsetting the raw text messages of tweets. That could be kind of a headache. Not to mention when you needed to retrieve followers, timelines, and everything that makes Twitter a richful place to mine for data. 

## Why I used rtweet? 


I've been using rtweet for several projects now, the more recent being: 

+ [#BreizhDataDay, revue de Tweets](http://breizhdataclub.org/breizhdataday-revue-de-tweets/) 

which I wrote just after the first [Breizh Data Day](https://breizhdataday.github.io/). 

So, {rtweet} is a (relatively) young package, as it was first published on CRAN around a year ago (august 2016). It provides a tidy approach to collecting Twitter data: main functions return a data.frame following the [tidy data](http://vita.had.co.nz/papers/tidy-data.html) principles.

A cool thing also, is that you don't need to set up a Twitter app in order to search for tweets.

## {rtweet} worklow

So, let's try searching for 1000 tweets with the hashtag Rennes with {rtweet}.

```r
library(rtweet)
srch <- search_tweets("#Rennes", n = 1000)
Searching for tweets...
Finished collecting tweets!
  
dplyr::glimpse(srch)
Observations: 992
Variables: 68
$ status_id               <chr> "953198154912096256", "953198020761473025", "953197760425152512...
$ created_at              <dttm> 2018-01-16 09:32:04, 2018-01-16 09:31:32, 2018-01-16 09:30:30,...
$ user_id                 <chr> "2175883022", "951577649419309061", "951577649419309061", "3558...
$ screen_name             <chr> "GillesPennelle", "Rkii14", "Rkii14", "k_rol18Quai", "Loulou183...
$ text                    <chr> "Un squat de #migrants où l'on entend des femmes hurler à proxi...
$ source                  <chr> "TweetDeck", "Twitter Lite", "Twitter Lite", "Twitter for iPhon...
$ display_text_width      <dbl> 265, 139, 140, 172, 129, 140, 189, 139, 216, 68, 68, 95, 214, 2...
$ reply_to_status_id      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ reply_to_user_id        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ reply_to_screen_name    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ is_quote                <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, ...
$ is_retweet              <lgl> FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE...
$ favorite_count          <int> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, ...
$ retweet_count           <int> 0, 8, 12, 0, 4, 196, 2, 2, 0, 0, 0, 0, 0, 0, 2, 0, 8, 0, 0, 73,...
$ hashtags                <list> [<"migrants", "Rennes">, "Rennes", "Rennes", <"expo", "art", "...
$ symbols                 <list> [NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
$ urls_url                <list> ["ouest-france.fr/bretagne/renne…", NA, NA, NA, "ouest-france....
$ urls_t.co               <list> ["https://t.co/g5XKcpjw52", NA, NA, NA, "https://t.co/1RjY8KA9...
$ urls_expanded_url       <list> ["https://www.ouest-france.fr/bretagne/rennes-35000/rennes-pre...
$ media_url               <list> [NA, NA, NA, "http://pbs.twimg.com/media/DTpvkwDW0AAFoOy.jpg",...
$ media_t.co              <list> [NA, NA, NA, "https://t.co/oh194HAlNF", NA, NA, "https://t.co/...
$ media_expanded_url      <list> [NA, NA, NA, "https://twitter.com/k_rol18Quai/status/953196971...
$ media_type              <list> [NA, NA, NA, "photo", NA, NA, "photo", NA, NA, NA, NA, NA, "ph...
$ ext_media_url           <list> [NA, NA, NA, <"http://pbs.twimg.com/media/DTpvkwDW0AAFoOy.jpg"...
$ ext_media_t.co          <list> [NA, NA, NA, <"https://t.co/oh194HAlNF", "https://t.co/oh194HA...
$ ext_media_expanded_url  <list> [NA, NA, NA, <"https://twitter.com/k_rol18Quai/status/95319697...
$ ext_media_type          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ mentions_user_id        <list> [NA, "3300206801", "15168040", "74419919", "2485423957", "4569...
$ mentions_screen_name    <list> [NA, "Inp_patrimoine", "metropolerennes", "mabanque_bnpp", "di...
$ lang                    <chr> "fr", "fr", "fr", "fr", "fr", "fr", "fr", "fr", "fr", "fr", "fr...
$ quoted_status_id        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "953193542494707712...
$ quoted_text             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Petra ober e miz G...
$ quoted_created_at       <dttm> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 2018-01-16 09:13:4...
$ quoted_source           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ quoted_favorite_count   <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, NA, ...
$ quoted_retweet_count    <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, NA, ...
$ quoted_user_id          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "15168040", NA, NA,...
$ quoted_screen_name      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "metropolerennes", ...
$ quoted_name             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "RennesVilleMétropo...
$ quoted_followers_count  <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 65765, NA, NA, NA, ...
$ quoted_friends_count    <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 769, NA, NA, NA, NA...
$ quoted_statuses_count   <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 15257, NA, NA, NA, ...
$ quoted_location         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Rennes", NA, NA, N...
$ quoted_description      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Twitter officiel d...
$ quoted_verified         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, TRUE, NA, NA, NA, N...
$ retweet_status_id       <chr> NA, "952865482440413184", "952940789209948160", NA, "9530556116...
$ retweet_text            <chr> NA, "Les élèves conservateurs du patrimoine de la promotion 201...
$ retweet_created_at      <dttm> NA, 2018-01-15 11:30:09, 2018-01-15 16:29:23, NA, 2018-01-16 0...
$ retweet_source          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ retweet_favorite_count  <int> NA, 18, 4, NA, 2, 354, NA, 3, NA, NA, NA, NA, NA, NA, 3, NA, 3,...
$ retweet_user_id         <chr> NA, "3300206801", "15168040", NA, "2485423957", "456900236", NA...
$ retweet_screen_name     <chr> NA, "Inp_patrimoine", "metropolerennes", NA, "dirloACJE91", "na...
$ retweet_name            <chr> NA, "Inp-patrimoine", "RennesVilleMétropole", NA, "François ROQ...
$ retweet_followers_count <int> NA, 3902, 65765, NA, 625, 10187, NA, 100, NA, NA, NA, NA, NA, N...
$ retweet_friends_count   <int> NA, 672, 769, NA, 1099, 1473, NA, 107, NA, NA, NA, NA, NA, NA, ...
$ retweet_statuses_count  <int> NA, 862, 15257, NA, 5072, 4262, NA, 212, NA, NA, NA, NA, NA, NA...
$ retweet_location        <chr> NA, "Paris - Aubervilliers", "Rennes", NA, "France", "Rennes", ...
$ retweet_description     <chr> NA, "L'Institut national du patrimoine est un établissement d'e...
$ retweet_verified        <lgl> NA, FALSE, TRUE, NA, FALSE, TRUE, NA, FALSE, NA, NA, NA, NA, NA...
$ place_url               <chr> NA, NA, NA, NA, NA, NA, "https://api.twitter.com/1.1/geo/id/626...
$ place_name              <chr> NA, NA, NA, NA, NA, NA, "Rennes", NA, NA, NA, NA, NA, NA, NA, N...
$ place_full_name         <chr> NA, NA, NA, NA, NA, NA, "Rennes, France", NA, NA, NA, NA, NA, N...
$ place_type              <chr> NA, NA, NA, NA, NA, NA, "city", NA, NA, NA, NA, NA, NA, NA, NA,...
$ country                 <chr> NA, NA, NA, NA, NA, NA, "France", NA, NA, NA, NA, NA, NA, NA, N...
$ country_code            <chr> NA, NA, NA, NA, NA, NA, "FR", NA, NA, NA, NA, NA, NA, NA, NA, N...
$ geo_coords              <list> [<NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <...
$ coords_coords           <list> [<NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <NA, NA>, <...
$ bbox_coords             <list> [<NA, NA, NA, NA, NA, NA, NA, NA>, <NA, NA, NA, NA, NA, NA, NA...
```

And here it is. Yes, it's that simple: 1000 tweets in two commands (and one being `library()`): __without specifying any oauth token__. 

So now we have a tidy data.frame with the results, hashtags are in a column we can easily parse and count, as are text, mentions, and everything needed to start mining data. 

### Quick example

> Note: the recent version of {rtweet} returns a list column, which is not handled by `unnest_tokens`. 

We can write a quick hashtag and sentiment analysis : 

```r
library(dplyr)
library(purrr)
library(proustr)
library(tidytext)

as_vector(srch$hashtags) %>% 
   table() %>% 
   as.data.frame() %>% 
   arrange(Freq) %>% 
   top_n(5)
Selecting by Freq
         . Freq
1    Stups   64
2    Brest   73
3 Bretagne   82
4   rennes  131
5   Rennes  863

srch %>% 
   discard(is.list) %>%
   unnest_tokens(word, text) %>%
   select(word) %>%
   left_join(proust_sentiments(type = "score")) %>%
   na.omit() %>%
   count(sentiment)
Joining, by = "word"
# A tibble: 6 x 2
  sentiment     n
      <chr> <int>
1     anger   196
2   disgust   134
3      fear   239
4       joy   136
5   sadness   247
6  surprise   208
```

Of course {rtweet} is full of other features you can try. But that blog post was more of an introduction, and I hope I've convinced you to download and use this amazing package!