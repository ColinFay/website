<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.4.1 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling - Colin FAY</title>




<meta name="description" content="Yes, this title is still a Queen reference.">




<meta name="author" content="colin_fay">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="Colin FAY">
<meta property="og:title" content="A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling">


  <link rel="canonical" href="http://localhost:4000/purrr-text-wrangling/">
  <meta property="og:url" content="http://localhost:4000/purrr-text-wrangling/">



  <meta property="og:description" content="Yes, this title is still a Queen reference.">



  <meta name="twitter:site" content="@_colinfay">
  <meta name="twitter:title" content="A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling">
  <meta name="twitter:description" content="Yes, this title is still a Queen reference.">
  <meta name="twitter:url" content="http://localhost:4000/purrr-text-wrangling/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png">
    
  

  
    <meta name="twitter:creator" content="@colin_fay">
  



  

  



  <meta property="og:image" content="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-11-29T00:00:00+01:00">






  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Colin FAY",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/_ColinFay","https://www.linkedin.com/in/colinfay/"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Colin FAY Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/favicon.png">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">Colin FAY</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/">Home</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/about/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/talks-publications/">Talks & Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/open-source/">Open Source</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://colinfay.me/categories/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://colinfay.me/r-manuals/">R manuals</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://avatars1.githubusercontent.com/u/17936236?v=3&s=460" alt="Colin FAY" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Colin FAY</h3>
    
      <p class="author__bio" itemprop="description">
        Data Science & Social Media at ThinkR. Founder of Data Bzh and cofounder of the Breizh Data Club.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Rennes</span>
        </li>
      

      

      
        <li>
          <a href="mailto:contact@colinfay.me">
            <meta itemprop="email" content="contact@colinfay.me" />
            <i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/_colinfay" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/colinfay" itemprop="sameAs">
            <i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/ColinFay" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
<li>
  <a href="http://www.thinkr.fr">
    <i class="fa fa-bookmark" aria-hidden="true"></i> ThinkR
  </a>
</li>
<li>
  <a href="http://data-bzh.fr">
    <i class="fa fa-map-marker" aria-hidden="true"></i> Data-Bzh
  </a>
</li>
<li>
  <a href="http://breizhdataclub.org/">
    <i class="fa fa-tag" aria-hidden="true"></i> Breizh Data Club
  </a>
</li>
<li>
  <a href="http://www.rweekly.org">
    <i class="fa fa-rss" aria-hidden="true"></i> RWeekly
  </a>
</li>

    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling">
    <meta itemprop="description" content="Yes, this title is still a Queen reference.">
    <meta itemprop="datePublished" content="November 29, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  5 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Yes, this title is still a Queen reference.</p>

<!--more-->

<p>I’ve recently been exchanging DM with Rémi (who writes cool stuffs about data science and SEO on his blog, so here’s some <a href="https://remibacha.com/">Google Juice</a> for him) who was looking for a way to turn this kind of dataframe:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">articlexyz for sale</td>
    </tr>
    <tr>
      <td style="text-align: left">cheap articlexyz</td>
    </tr>
    <tr>
      <td style="text-align: left">razor articlexyz</td>
    </tr>
    <tr>
      <td style="text-align: left">articlexyz walmart</td>
    </tr>
    <tr>
      <td style="text-align: left">articlexyz games</td>
    </tr>
    <tr>
      <td style="text-align: left">articlexyz amazon</td>
    </tr>
    <tr>
      <td style="text-align: left">bluetooth articlexyz</td>
    </tr>
    <tr>
      <td style="text-align: left">how much is a articlexyz</td>
    </tr>
    <tr>
      <td style="text-align: left">articlexyz for sale cheap</td>
    </tr>
  </tbody>
</table>

<p>Into something like :</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">for sale</td>
    </tr>
    <tr>
      <td style="text-align: left">cheap</td>
    </tr>
    <tr>
      <td style="text-align: left">razor</td>
    </tr>
    <tr>
      <td style="text-align: left">walmart</td>
    </tr>
    <tr>
      <td style="text-align: left">games</td>
    </tr>
    <tr>
      <td style="text-align: left">amazon</td>
    </tr>
    <tr>
      <td style="text-align: left">bluetooth</td>
    </tr>
    <tr>
      <td style="text-align: left">how much is a</td>
    </tr>
    <tr>
      <td style="text-align: left">for sale cheap</td>
    </tr>
  </tbody>
</table>

<p>If ever you’ve been playing with adwords, this may look like something you’re familiar with (I guess this is what Rémi has been playing with).</p>

<p>Anyway, the question then is how to write a function that can remove the n most common words out of this data.frame. As you know, I love {purrr}, and this is the kind of exercise I just can’t resist to solve.</p>

<p>So basically, here’s the how-to.</p>

<h2 id="a-little-bit-of-context">A little bit of context</h2>

<p>The first thing that came to my mind there (there might be some more straightforward ways to do this, feel free to comment at the bottom of this article if you have another approach) is to build a regex and <code class="highlighter-rouge">str_replace</code> the matching patterns (i.e. the top words) with a blank.</p>

<p>This is kind of easy if you’ve just want to remove the most common one. But I wanted to have a more flexible function which could remove as many common words as I wanted. More or less, something that takes a n arg and remove the n most commons.</p>

<p>Basically, in this example, the most common word is articlexyz, so I want a function that can remove just this one, or articlexyz and the second most common, etc.</p>

<p>Oh, and of course, with tidy eval.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span><span class="w">
</span><span class="c1"># Here's my example data.frame</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">Keywords</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"articlexyz for sale"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"cheap articlexyz for sale"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"amazon articlexyz"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"articlexyz walmart cheap"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"articlexyz games"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"articlexyz amazon"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"bluetooth articlexyz"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"how much is a articlexyz on amazon"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"articlexyz for sale cheap"</span><span class="w"> 
</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<h2 id="the-regex-builder">The regex builder</h2>

<p>So, here’s how to build a regex builder of the most common words with {purrr}, {dplyr} and {tidytext}.</p>

<h3 id="first-of-all-extract-the-most-common">First of all, extract the most common</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">concat_commons</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">){</span><span class="w">
  </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="o">!!</span><span class="w"> </span><span class="n">enquo</span><span class="p">(</span><span class="n">col</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">anti_join</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">levels</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">pull</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p>Nothing fancy here, just a common words extractor :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"articlexyz"</span><span class="w"> </span><span class="s2">"amazon"</span><span class="w"> 
</span></code></pre></div></div>

<h3 id="the-regex-builder-1">The regex builder</h3>

<p>The most complex thing here is that my end result should match only words, not letter inside a word: i.e. if “a” is the most common word, <code class="highlighter-rouge">articlexyz</code> should be turned into <code class="highlighter-rouge">rticlexyz</code>, but ‘<code class="highlighter-rouge"> a </code>’ (space-a-space) should be removed. Here, you can’t go for for space-pattern-space matching, cause “articlexyz bla bla bla” won’t match because there is no blank at the beginning. ^articlexyz$ won’t match “bla articlexyz bla bla” either, as this is a blank-word-blank pattern.</p>

<p>So let’s be this xkcd guy :</p>

<p><img src="https://imgs.xkcd.com/comics/regular_expressions.png" alt="" /></p>

<p>Here’s the regex put at the beginning and the end of the pattern : <code class="highlighter-rouge">\\barticlexyz\\b</code>, as <code class="highlighter-rouge">\b</code>  will match a word bundary.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regex_build</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">list</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Make sure only the words are matched</span><span class="w">
  </span><span class="n">map</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"\\b"</span><span class="p">,</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="s2">"\\b"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># Reduce everything</span><span class="w">
    </span><span class="n">reduce</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.y</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>So we’ve got our regex with:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">regex_build</span><span class="p">()</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"\\barticlexyz\\b|\\bamazon\\b"</span><span class="w">
</span></code></pre></div></div>
<p>Let’s bulk replace</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bulk_replace</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">){</span><span class="w">
    </span><span class="n">map</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regex</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># Prevent the "too many spaces" to come</span><span class="w">
    </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" {2,}"</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">regex_build</span><span class="p">()</span><span class="w"> 
</span><span class="n">bulk_replace</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Keywords</span><span class="p">)</span><span class="w">

</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" for sale"</span><span class="w">

</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"cheap for sale"</span><span class="w">

</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" "</span><span class="w">

</span><span class="p">[[</span><span class="m">4</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" walmart cheap"</span><span class="w">

</span><span class="n">....</span><span class="w">

</span></code></pre></div></div>

<h3 id="the-not-so-regex-solution">The not-so-regex solution</h3>

<p>If you’re not that into regex (nobody’s perfect), let’s do something with less regex and more {purrr}: string split, map, reduce.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regex_build</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">list</span><span class="p">){</span><span class="w">
    </span><span class="n">reduce</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.y</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>Simple regex here:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">regex_build</span><span class="p">()</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"articlexyz|amazon"</span><span class="err">"</span><span class="w">
</span></code></pre></div></div>

<h3 id="bulk-replace-this-with-stringsplit">Bulk replace this with stringsplit</h3>

<p>Here the trick to forget this “beginning end whitespace” nightmare (not a nightmare, really) is to split and test every element against the regex, so split, replace, unsplit.</p>

<p>To do the “unsplit”, as the result is a list of depth one, we need to <code class="highlighter-rouge">modify_depth</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bulk_replace</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">){</span><span class="w">
  </span><span class="n">str_split</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="s2">" "</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regex</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># We need to modify at the first level </span><span class="w">
    </span><span class="n">modify_depth</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">reduce</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.y</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># Prevent the "too many spaces" to come</span><span class="w">
    </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" {2,}"</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">regex_build</span><span class="p">()</span><span class="w"> 
</span><span class="n">bulk_replace</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Keywords</span><span class="p">)</span><span class="w">

</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" for sale"</span><span class="w">

</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"cheap for sale"</span><span class="w">

</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" "</span><span class="w">

</span><span class="p">[[</span><span class="m">4</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">" walmart cheap"</span><span class="w">

</span><span class="n">....</span><span class="w">

</span></code></pre></div></div>

<p>Yes. The very same result.</p>

<h3 id="remove-commons">Remove commons</h3>

<p>Ok let’s wrap this in a function :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">remove_commons</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">){</span><span class="w">
  </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enquo</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w">
  </span><span class="n">output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quo_name</span><span class="p">(</span><span class="n">enquo</span><span class="p">(</span><span class="n">output</span><span class="p">))</span><span class="w">
  </span><span class="n">most_common</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="o">!!</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">)</span><span class="w">
  </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="o">!!</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">bulk_replace</span><span class="p">(</span><span class="w"> </span><span class="n">regex_build</span><span class="p">(</span><span class="n">most_common</span><span class="p">),</span><span class="w"> </span><span class="o">!!</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unnest</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>So here, we’ve got a function that takes a data.frame, the name of the input and output columns, and the number of common words to remove. Let’s try this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">remove_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1"># A tibble: 9 x 2</span><span class="w">
                            </span><span class="n">Keywords</span><span class="w">             </span><span class="n">group</span><span class="w">
                               </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">
</span><span class="m">1</span><span class="w">                </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">
</span><span class="m">2</span><span class="w">          </span><span class="n">cheap</span><span class="w"> </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">    </span><span class="n">cheap</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">
</span><span class="m">3</span><span class="w">                  </span><span class="n">amazon</span><span class="w"> </span><span class="n">articlexyz</span><span class="w">                  
</span><span class="m">4</span><span class="w">           </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">walmart</span><span class="w"> </span><span class="n">cheap</span><span class="w">     </span><span class="n">walmart</span><span class="w"> </span><span class="n">cheap</span><span class="w">
</span><span class="m">5</span><span class="w">                   </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">games</span><span class="w">             </span><span class="n">games</span><span class="w">
</span><span class="m">6</span><span class="w">                  </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">amazon</span><span class="w">                  
</span><span class="m">7</span><span class="w">               </span><span class="n">bluetooth</span><span class="w"> </span><span class="n">articlexyz</span><span class="w">        </span><span class="n">bluetooth</span><span class="w"> 
</span><span class="m">8</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">amazon</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">on</span><span class="w"> 
</span><span class="m">9</span><span class="w">          </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w"> </span><span class="n">cheap</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w"> </span><span class="n">cheap</span><span class="w">
</span></code></pre></div></div>

<p>🎉 !!</p>

<p>Of course we’ve got some blank shere, as two observations are composed of the most common words
. Let’s count:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">remove_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">anti_join</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
 </span><span class="n">A</span><span class="w"> </span><span class="n">tibble</span><span class="o">:</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="m">2</span><span class="w">
       </span><span class="n">word</span><span class="w">     </span><span class="n">n</span><span class="w">
      </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="w">
</span><span class="m">1</span><span class="w">    </span><span class="n">amazon</span><span class="w">     </span><span class="m">3</span><span class="w">
</span><span class="m">2</span><span class="w">     </span><span class="n">cheap</span><span class="w">     </span><span class="m">3</span><span class="w">
</span><span class="m">3</span><span class="w">      </span><span class="n">sale</span><span class="w">     </span><span class="m">3</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="n">bluetooth</span><span class="w">     </span><span class="m">1</span><span class="w">
</span><span class="m">5</span><span class="w">     </span><span class="n">games</span><span class="w">     </span><span class="m">1</span><span class="w">
</span><span class="m">6</span><span class="w">   </span><span class="n">walmart</span><span class="w">     </span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<h3 id="labels">Labels</h3>

<p>So now, maybe we want to assign each observation to its “most common label but not the n first”, that is to say, I want “articlexyz for sale on amazon” to be assigned a label “sale” if this is the most common after the n, or amazon, etc.</p>

<p>So here comes <code class="highlighter-rouge">detect()</code> :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">which_label</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">detect</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">grepl</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">))</span><span class="w"> </span><span class="o">%||%</span><span class="w"> </span><span class="kc">NA</span><span class="w"> 
</span><span class="p">}</span><span class="w">

</span><span class="c1"># List of common words :</span><span class="w">
</span><span class="n">commons_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">concat_commons</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">Keywords</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map_chr</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Keywords</span><span class="p">,</span><span class="w"> 
                         </span><span class="o">~</span><span class="w"> </span><span class="n">which_label</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">common_words</span><span class="o">$</span><span class="n">group</span><span class="p">)))</span><span class="w"> 
</span><span class="c1"># A tibble: 9 x 2</span><span class="w">
                            </span><span class="n">Keywords</span><span class="w">     </span><span class="n">group</span><span class="w">
                               </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">     </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">
</span><span class="m">1</span><span class="w">                </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">      </span><span class="n">sale</span><span class="w">
</span><span class="m">2</span><span class="w">          </span><span class="n">cheap</span><span class="w"> </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w">     </span><span class="n">cheap</span><span class="w">
</span><span class="m">3</span><span class="w">                  </span><span class="n">amazon</span><span class="w"> </span><span class="n">articlexyz</span><span class="w">    </span><span class="n">amazon</span><span class="w">
</span><span class="m">4</span><span class="w">           </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">walmart</span><span class="w"> </span><span class="n">cheap</span><span class="w">     </span><span class="n">cheap</span><span class="w">
</span><span class="m">5</span><span class="w">                   </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">games</span><span class="w">     </span><span class="n">games</span><span class="w">
</span><span class="m">6</span><span class="w">                  </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">amazon</span><span class="w">    </span><span class="n">amazon</span><span class="w">
</span><span class="m">7</span><span class="w">               </span><span class="n">bluetooth</span><span class="w"> </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">bluetooth</span><span class="w">
</span><span class="m">8</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">articlexyz</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">amazon</span><span class="w">    </span><span class="n">amazon</span><span class="w">
</span><span class="m">9</span><span class="w">          </span><span class="n">articlexyz</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sale</span><span class="w"> </span><span class="n">cheap</span><span class="w">     </span><span class="n">cheap</span><span class="w">
</span></code></pre></div></div>

<p>And now, let’s sell some Google Ads!</p>

<p><img src="https://i.giphy.com/media/VTxmwaCEwSlZm/200.gif" alt="" /></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#purrr" class="page__taxonomy-item" rel="tag">purrr</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#r-blog-en" class="page__taxonomy-item" rel="tag">r-blog-en</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-11-29T00:00:00+01:00">November 29, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=_colinfay&text=A Crazy Little Thing Called {purrr} - Part 2 : Text Wrangling http://localhost:4000/purrr-text-wrangling/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/purrr-text-wrangling/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/purrr-text-wrangling/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/purrr-text-wrangling/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/purrr-web-mining/" class="pagination--pager" title="A Crazy Little Thing Called {purrr} - Part 1 : Web Mining
">Previous</a>
    
    
      <a href="http://localhost:4000/purrr-set-na/" class="pagination--pager" title="A Crazy Little Thing Called {purrr} - Part 3 : Setting NA
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/_colinfay"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/ColinFay"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Colin FAY. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65307055-3', 'auto');
  ga('send', 'pageview');
</script>







  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'http-colinfay-me';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
