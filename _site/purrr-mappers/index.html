<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.4.1 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>A Crazy Little Thing Called {purrr} - Part 4: mappers - Colin FAY</title>




<meta name="description" content="I won’t talk about the Queen reference anymore.">




<meta name="author" content="colin_fay">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="Colin FAY">
<meta property="og:title" content="A Crazy Little Thing Called {purrr} - Part 4: mappers">


  <link rel="canonical" href="http://localhost:4000/purrr-mappers/">
  <meta property="og:url" content="http://localhost:4000/purrr-mappers/">



  <meta property="og:description" content="I won’t talk about the Queen reference anymore.">



  <meta name="twitter:site" content="@_colinfay">
  <meta name="twitter:title" content="A Crazy Little Thing Called {purrr} - Part 4: mappers">
  <meta name="twitter:description" content="I won’t talk about the Queen reference anymore.">
  <meta name="twitter:url" content="http://localhost:4000/purrr-mappers/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png">
    
  

  
    <meta name="twitter:creator" content="@colin_fay">
  



  

  



  <meta property="og:image" content="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-12-12T00:00:00+01:00">






  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/uploads/2017/08/colin_prev.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Colin FAY",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/_ColinFay","https://www.linkedin.com/in/colinfay/"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Colin FAY Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/ColinFay/colinfay.github.io/master/favicon.png">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">Colin FAY</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/">Home</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/about/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/talks-publications/">Talks & Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://colinfay.github.io/open-source/">Open Source</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://colinfay.me/categories/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://colinfay.me/r-manuals/">R manuals</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">A Crazy Little Thing Called {purrr} - Part 4: mappers</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://avatars1.githubusercontent.com/u/17936236?v=3&s=460" alt="Colin FAY" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Colin FAY</h3>
    
      <p class="author__bio" itemprop="description">
        Data Science & Social Media at ThinkR. Founder of Data Bzh and cofounder of the Breizh Data Club.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Rennes</span>
        </li>
      

      

      
        <li>
          <a href="mailto:contact@colinfay.me">
            <meta itemprop="email" content="contact@colinfay.me" />
            <i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/_colinfay" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/colinfay" itemprop="sameAs">
            <i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/ColinFay" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
<li>
  <a href="http://www.thinkr.fr">
    <i class="fa fa-bookmark" aria-hidden="true"></i> ThinkR
  </a>
</li>
<li>
  <a href="http://data-bzh.fr">
    <i class="fa fa-map-marker" aria-hidden="true"></i> Data-Bzh
  </a>
</li>
<li>
  <a href="http://breizhdataclub.org/">
    <i class="fa fa-tag" aria-hidden="true"></i> Breizh Data Club
  </a>
</li>
<li>
  <a href="http://www.rweekly.org">
    <i class="fa fa-rss" aria-hidden="true"></i> RWeekly
  </a>
</li>

    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="A Crazy Little Thing Called {purrr} - Part 4: mappers">
    <meta itemprop="description" content="I won’t talk about the Queen reference anymore.">
    <meta itemprop="datePublished" content="December 12, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">A Crazy Little Thing Called {purrr} - Part 4: mappers
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  5 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>I won’t talk about the Queen reference anymore.</p>

<!--more-->

<p>I’ve been working lately on a new package called {trycatchthis}, which
is an attempt at making try catch and condition handling in R a little
bit friendlier. If you have some time to spare, I’ll be glad if you can
give me some feedbacks about it: positive, negative, PR, improvement
suggestions <a href="https://github.com/ColinFay/trycatchthis">https://github.com/ColinFay/trycatchthis</a>… Feel free!</p>

<p>This package relies a lot on {purrr} mappers (and on {rlang} but I won’t
be talking about {rlang} today… maybe in another series of posts). Today
I’m gonna talk briefly about this cool stuff in {purrr} called mappers.
(Well, these mappers are forwarded to {rlang} so this is a cool stuff
from {rlang}, yet the mappers constructor <code class="highlighter-rouge">as_mapper</code> is a {purrr}
function).</p>

<h2 id="what-on-earth-are-mappers">What on earth are mappers</h2>

<p>You’ve been using mappers a lot if, like me, you’ve been using {purrr} a
lot. These are the one sided formulas which are created as such :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span><span class="w">
</span><span class="n">map_dbl</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 10 20 30
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># or </span><span class="w">
</span><span class="n">map_dbl</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 10 20 30
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># or </span><span class="w">
</span><span class="n">map2_dbl</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">.y</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 4 6 8
</code></pre></div></div>

<p>Here, you’re creating a lambda function on the fly: the first and second
multiplying each element by 10, and the third adding each <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code>
together.</p>

<h2 id="whats-happening-behind">What’s happening behind?</h2>

<p>The first thing that <code class="highlighter-rouge">map</code> (and other map_*) do is turning a the <code class="highlighter-rouge">~ .x
\* 10</code> into a mapper with <code class="highlighter-rouge">as_mapper</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function(.x, .f, ...) {
##   .f &lt;- as_mapper(.f, ...)
##   .Call(map_impl, environment(), ".x", ".f", "list")
## }
## &lt;environment: namespace:purrr&gt;
</code></pre></div></div>

<p>In the background, mappers are created with {rlang} <code class="highlighter-rouge">as_function</code>: so,
as you could have guessed, this turns formulas into functions.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">addition</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_mapper</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">.y</span><span class="p">)</span><span class="w">
</span><span class="n">addition</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function (..., .x = ..1, .y = ..2, . = ..1) 
## .x + .y
</code></pre></div></div>

<p>As you can see, the function is created with the .x matching the first
argument, the .y matching the second, and the . alone matching the
first. It’s that simple, you now have a good old R function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">addition</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 4
</code></pre></div></div>

<h2 id="how-is-that-useful">How is that useful?</h2>

<h3 id="dont-repeat-yourself">Don’t repeat yourself</h3>

<p>This first comes handy when you have a lot of mapping to do:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map2_int</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">addition</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 5 7 9
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map2_int</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">21</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">addition</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] 22 24 26 28 30 32 34 36 38 40
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map2_int</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">addition</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 6 8
</code></pre></div></div>

<h3 id="flexible-mappers">Flexible mappers</h3>

<p>Mappers are what allow {purrr} flexibility with mapping, as it alows you
to use a defaut R functions inside map:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as_mapper</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function (x) 
## is.numeric(x = x)
## &lt;environment: base&gt;
</code></pre></div></div>

<p>or characters and numbers that creates calls to <code class="highlighter-rouge">pluck</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as_mapper</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function (x, ...) 
## pluck(x, list(1), .default = NULL)
## &lt;environment: 0x7fb2cb62a950&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as_mapper</span><span class="p">(</span><span class="s2">"this"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function (x, ...) 
## pluck(x, list("this"), .default = NULL)
## &lt;environment: 0x7fb2cd9fb158&gt;
</code></pre></div></div>

<p>or even another lambda function :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as_mapper</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## function(x, y) {x+y}
</code></pre></div></div>

<h3 id="mappers-with-more-than-two-arguments">mappers with more than two arguments</h3>

<p>So, here’s the trick if you want to create mappers with more than two
arguments: use <code class="highlighter-rouge">..1</code>, <code class="highlighter-rouge">..2</code>, <code class="highlighter-rouge">..3</code>, etc. Here’s an example with <code class="highlighter-rouge">pmap</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">),</span><span class="w">
          </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">),</span><span class="w"> 
          </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">))</span><span class="w">
</span><span class="n">pmap_dbl</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">.</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="m">.3</span><span class="p">))</span><span class="w"> 
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] -0.431030092  0.007889214 -0.051816152
</code></pre></div></div>

<h2 id="using-mapper-inside-trycatchthis">Using mapper inside {trycatchthis}</h2>

<h3 id="try_catch">try_catch</h3>

<p>These are also what allows {trycatchthis} to be flexible when building
trycatch calls and condition handlers.</p>

<p>As you may know, <code class="highlighter-rouge">tryCatch</code> takes four arguments :</p>

<ul>
  <li>The expression to evaluate (mandatory)</li>
  <li>A <strong>function</strong> to be run on error</li>
  <li>A <strong>function</strong> to be run on warning</li>
  <li>A <strong>function</strong> to be run on exit</li>
</ul>

<p>So if you’ve followed along, you now know that I can use mappers here as
arguments of a <code class="highlighter-rouge">tryCatch</code> call. This is exactly what <code class="highlighter-rouge">try_catch</code>, from
{trycatchthis}, does.</p>

<p>Here’s a shorten example (and slightly different from the one in
{trycatchthis} as <code class="highlighter-rouge">try_that</code> is built with {rlang} <code class="highlighter-rouge">lang</code>) :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">try_catch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="w"> </span><span class="n">.e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tryCatch</span><span class="p">(</span><span class="w"> </span><span class="n">expr</span><span class="p">,</span><span class="w">
    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as_mapper</span><span class="p">(</span><span class="n">.e</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">try_catch</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="s2">"a"</span><span class="p">),</span><span class="w"> </span><span class="n">.e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"There was an error:"</span><span class="p">,</span><span class="w"> </span><span class="n">.x</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "There was an error: Error in log(\"a\"): argument non numérique pour une fonction mathématique\n"
</code></pre></div></div>

<h3 id="stop_if">stop_if</h3>

<p>As package developers, we need to keep in mind that everything is
possible when it comes to functions being used in the wild (characters
in place of number is just an example).</p>

<p>So the first lines of a function are usually used to verify the inputs.
Like :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pimped_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"x and y must be numeric"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">pimped_sum</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in pimped_sum("1", 2): x and y must be numeric
</code></pre></div></div>

<p>But that’s a lot of duplicated code, a lot of if if there are lot of
checks to do, and not that much functions stating clearly what they do.</p>

<p>So here comes
    {trycatchthis}:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">trycatchthis</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in library(trycatchthis): there is no package called 'trycatchthis'
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pimped_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w">
  </span><span class="n">stop_if_any</span><span class="p">(</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> 
               </span><span class="o">~</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">.x</span><span class="p">),</span><span class="w"> 
               </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"your args should be numeric"</span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">pimped_sum</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in stop_if_any(c(x, y), ~!is.numeric(.x), msg = "your args should be numeric"): impossible de trouver la fonction "stop_if_any"
</code></pre></div></div>

<p>You can have a look at what {trycatchthis} does on the <a href="https://github.com/ColinFay/trycatchthis">GitHub
repo</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Simpler example</span><span class="w">
</span><span class="n">small_by_ten</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">stop_if</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> 
           </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> 
           </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"x should be less than ten"</span><span class="w"> </span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">small_by_ten</span><span class="p">(</span><span class="m">11</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in stop_if(x, ~.x &gt; 10, msg = "x should be less than ten"): impossible de trouver la fonction "stop_if"
</code></pre></div></div>

<p>So here, you can see that we are using a formula inside <code class="highlighter-rouge">stop_if</code>. How
does if work ? The second argument is turned into a mapper, and then
used to test x. Here’s a simplified version of this function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stop_if</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.p</span><span class="p">){</span><span class="w">
  </span><span class="n">.p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_mapper</span><span class="p">(</span><span class="n">.p</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">.p</span><span class="p">(</span><span class="n">.x</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
      </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Error!"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">stop_if</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in stop_if(10, ~.x &lt; 11): Error!
</code></pre></div></div>

<p>The flexibily of the mapper system allows you to pass base and classical
function, because as we’ve seen, they are all turned to the same
function template :</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stop_if</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">is.numeric</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in stop_if(10, is.numeric): Error!
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stop_if</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in stop_if(10, function(x) sqrt(x) &lt; 100): Error!
</code></pre></div></div>

<p>Aaaaaand that’s it for today :)</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#purrr" class="page__taxonomy-item" rel="tag">purrr</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#r-blog-en" class="page__taxonomy-item" rel="tag">r-blog-en</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-12-12T00:00:00+01:00">December 12, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=_colinfay&text=A Crazy Little Thing Called {purrr} - Part 4: mappers http://localhost:4000/purrr-mappers/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/purrr-mappers/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/purrr-mappers/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/purrr-mappers/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/purrr-set-na/" class="pagination--pager" title="A Crazy Little Thing Called {purrr} - Part 3 : Setting NA
">Previous</a>
    
    
      <a href="http://localhost:4000/purrr-code-optim/" class="pagination--pager" title="A Crazy Little Thing Called {purrr} - Part 5: code optimization
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/_colinfay"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/ColinFay"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Colin FAY. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65307055-3', 'auto');
  ga('send', 'pageview');
</script>







  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'http-colinfay-me';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
